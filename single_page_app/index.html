<!DOCTYPE html>
<html>

<head>
    <title>String Expression Builder</title>
    <script type="module" src="stringReader.js"></script>
    <script type="module" src="parser.js"></script>
    <script type="module" src="expression.js"></script>
    <script type="module" src="expressionEvaluation.js"></script>
    <link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>
    <h1>String Expression Builder</h1>
    <a href="https://github.com/eladperets/ExpressionBuilder">The source code can be found here</a><br>
    <br>
    Use this tool to build complex string expressions. The syntax is similiar to C macros.<br>
    While it can have many uses, it was written to help with writing complex <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/template-functions">template functions</a> used in Azure Resource Manager and Azure Policy.<br>

    <h2>Usage:</h2>
    <ul>
        <li>Define expressions using the #def command (<i>#def HI Hello</i>)</li>
        <li>Expressions can refer to previously defined expressions (<i>#def HI_WORLD HI World</i>)</li>
        <li>
            The last command must be an #eval command that will evaluate the final expression:<br>
            <ul>
                <li>#eval can contain any free text.</li>
                <li>#eval can refer to any of the previously defined expressions.</li>
            </ul>
        </li>
      </ul>
    <textarea id="input" rows="20" cols="150" spellcheck="false"></textarea>
    </br>
    <input id="evaluate" type="button" value="Evaluate">
    <input id="create_link" type="button" value="Create Link">
    <script type="module">
        import { evaluateExpression } from './expressionEvaluation.js'
        
        function setEvaluatedExpression() {
            document.getElementById('output').innerText = evaluateExpression(document.getElementById('input').value);
        }

        function createLink() {
            document.getElementById('output').innerText = document.URL.split('?')[0] + '?expression=' + encodeURIComponent(document.getElementById('input').value);
        }

        document.getElementById('evaluate').onclick = setEvaluatedExpression;
        document.getElementById('create_link').onclick = createLink;

        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('expression')) {
            document.getElementById('input').value = urlParams.get('expression');
        } else {
            document.getElementById('input').value = "#def HI Hello\n#def HI_WORLD HI World\n\n#eval HI_WORLD!!"   
        }
    </script>
    <h3>Output:</h3>
    <pre id="output" style="min-height:5em;border-style:solid;overflow-x:auto;"></pre>
</body>

</html>